namespace = ps

# ps.1: Spawn Planet States
event = {
	id = ps.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		# Planet State 1: The Ecumenopolis
		random_system = {
			limit = {
				NOR = {
					is_fe_cluster = yes
					has_star_flag = empire_home_system
					has_star_flag = empire_cluster
					has_star_flag = enclave
					has_star_flag = guardian
					has_star_flag = hostile_system
					has_star_flag = marauder_system
					has_star_flag = caravaneer_home
				}
				is_bottleneck_system = yes
				any_system_planet = {
					uninhabitable_regular_planet = yes
					has_anomaly = no
				}
			}

			# Choose appropriate planet
			random_system_planet = {
				limit = {
					uninhabitable_regular_planet = yes
					has_anomaly = no
				}

				# Set Planet Size and Class
				prevent_anomaly = yes
				set_planet_size = 25
				change_pc = pc_city

				# Create Species and Country
				create_species = {
					name = random
					class = random_non_machine
					portrait = random
					traits = random
				}
				create_country = {
					name = "PLANET STATE"
					type = planet_state
					authority = "auth_democratic"
					civics = random
					species = last_created
					flag = random
					ethos = {
						ethic = ethic_fanatic_egalitarian
					}
					ignore_initial_colony_error = yes
				}

				# Create Station and Leader
				last_created_country = {
					set_country_flag = ps_ecumenopolis
					save_event_target_as = first_planet_state
					set_graphical_culture = mammalian_01
					create_fleet = {
						name = "PLANET STATE STATION"
						settings = { spawn_debris = no }
						effect = {
							set_owner = prev
							create_ship = {
								name = random
								design = "NAME_Planet_State_Station"
								graphical_culture = prev
							}
							set_location = {
								target = prevprev
								angle = random
								distance = 15
							}
						}
					}
					create_leader = {
						class = ruler
						species = prev
						name = random
						skill = 5
					}
					set_leader = last_created_leader
				}

				# Set Planet State as Owner of the planet
				set_owner = event_target:first_planet_state
				set_controller = event_target:first_planet_state
				set_capital = yes

				# Add Builings, Districts, Pops
				add_building = building_planet_state_capitol
				add_building = building_hall_judgment
				add_building = building_anti_matter_reactor
				add_building = building_hydroponics_farms_complex
				add_building = building_hydroponics_farms_complex
				add_building = building_mineral_purification_complex
				add_building = building_mineral_purification_complex
				add_building = building_multidimensional_printers
				add_building = building_leisure_complex
				add_building = building_distillation_complex
				add_building = building_chemical_complex
				add_building = building_synthesizer_complex
				add_building = building_galactic_stock_exchange
				while = {
					count = 25
					add_district = district_arcology_housing
				}
				while = {
					count = 350
					create_pop = {
						species = owner_main_species
						ethos = { ethic = ethic_fanatic_egalitarian }
					}
				}

			}
		}
	}
}

# ps.2: Planet State Yearly Border Opinion

# ps.3: Add +1 opinion per year

# ps.4: Entering Planet State system for the first time

# ps.5: First contact

# ps.100: The Ecumenopolis - Main Menu
country_event = {
	id = ps.100
	title = ps.100.name
	desc = ps.100a.desc
	location = From

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = From
		planet_background = From
		graphical_culture = From
		city_level = From
		room = From.ruler
	}

	trigger = {
		from = {
			is_country_type = planet_state
			has_country_flag = ps_ecumenopolis
		}
		NOT = { has_country_flag = ps_ecumenopolis_diplomacy_engaged }
		NOT = { has_country_flag = attacked_ps_ecumenopolis }
	}

	immediate = {
		set_country_flag = ps_ecumenopolis_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_ecumenopolis_diplomacy_engaged
		}
	}

	# Goodbye
	option = {
		name = ps.100.goodbye
	}
}
