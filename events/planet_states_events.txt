namespace = ps

# ps.1: Spawn Planet-States (on_game_start)
event = {
	id = ps.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {

		# Planet-State 1: The Egalitrian
		random_system = {
			limit = { is_appropriate_planet_state_system = yes }
			create_planet_state_egalitarian = yes
			event_target:target_ps_egalitarian = { country_event = { id = ps.2 days = 1 } }
		}

		# Planet-State 2: The Authoritarian
		random_system = {
			limit = { is_appropriate_planet_state_system = yes }
			create_planet_state_authoritarian = yes
			event_target:target_ps_authoritarian = { country_event = { id = ps.3 days = 1 } }
		}

		# Planet-State 3: The Militarist
		random_system = {
			limit = { is_appropriate_planet_state_system = yes }
			create_planet_state_militarist = yes
			event_target:target_ps_militarist = { country_event = { id = ps.4 days = 1 } }
		}

		# Planet-State 4: The Pacifist
		random_system = {
			limit = { is_appropriate_planet_state_system = yes }
			create_planet_state_pacifist = yes
		}
	}
}

# ps.2: Spawn adjustments for Egalitarian PS
country_event = {
	id = ps.2
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:ps_egalitarian_main_species = {
			set_citizenship_type = {
				type = citizenship_full
				country = event_target:target_ps_egalitarian
			}
			set_living_standard = {
				type = living_standard_utopian
				country = event_target:target_ps_egalitarian
			}
		}
	}
}

# ps.3: Spawn adjustments for Authoritarian PS
country_event = {
	id = ps.3
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:ps_authoritarian_main_species = {
			set_citizenship_type = {
				type = citizenship_full
				country = event_target:target_ps_authoritarian
			}
			set_living_standard = {
				type = living_standard_chemical_bliss
				country = event_target:target_ps_authoritarian
			}
		}
		event_target:ps_authoritarian_specialist_species = {
			set_citizenship_type = {
				type = citizenship_limited
				country = event_target:target_ps_authoritarian
			}
			set_living_standard = {
				type = living_standard_stratified
				country = event_target:target_ps_authoritarian
			}
		}
		event_target:ps_authoritarian_servile_species = {
			set_citizenship_type = {
				type = citizenship_slavery
				country = event_target:target_ps_authoritarian
			}
			set_living_standard = {
				type = living_standard_subsistence
				country = event_target:target_ps_authoritarian
			}
			set_slavery_type = {
				type = slavery_domestic
				country = event_target:target_ps_authoritarian
			}
		}
		event_target:ps_authoritarian_slave_species = {
			set_citizenship_type = {
				type = citizenship_slavery
				country = event_target:target_ps_authoritarian
			}
			set_living_standard = {
				type = living_standard_subsistence
				country = event_target:target_ps_authoritarian
			}
			set_slavery_type = {
				type = slavery_normal
				country = event_target:target_ps_authoritarian
			}
		}
	}
}

# ps.4: Spawn adjustments for Militarist PS
country_event = {
	id = ps.4
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		event_target:ps_militarist_main_species = {
			set_citizenship_type = {
				type = citizenship_full
				country = event_target:target_ps_militarist
			}
			set_living_standard = {
				type = living_standard_good
				country = event_target:target_ps_militarist
			}
		}
		event_target:ps_militarist_robot_species = {
			set_military_service_type = {
				type = military_service_none
				country = event_target:target_ps_militarist
			}
		}
	}
}

# ps.10: Planet-State Yearly Border Opinion (on_yearly_pulse)
event = {
	id = ps.10
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_country = {
			limit = { is_country_type = planet_state }
			country_event = { id = ps.11 }
		}
	}
}

# ps.11: Add +1 opinion per year (called by ps.3)
country_event = {
	id = ps.11
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_owned_fleet = {
			limit = {
				exists = solar_system
				solar_system = {
					exists = space_owner
					space_owner = {
						is_country_type = default
					}
				}
			}
			solar_system = {
				space_owner = {
					root = {
						add_trust = {
							who = prev
							amount = 1
						}
					}
				}
			}
		}
	}
}

# ps.12: Entering Planet-State system for the first time (on_entering_system_fleet)
fleet_event = {
	id = ps.12
	title = ps.12.name
	desc = ps.12.desc
	picture = GFX_evt_throne_room
	show_sound = event_radio_chatter
	location = event_target:target_planet_state

	is_triggered_only = yes

	trigger = {
		owner = {
			is_country_type = default
			exists = capital_scope
		}
		From = {
			has_star_flag = planet_state
			any_system_planet = {
				exists = owner
				owner = {
					is_country_type = planet_state
					NOT = { has_communications = root.owner }
				}
			}
		}
	}

	immediate = {
		From = {
			random_system_planet = {
				limit = {
					exists = owner
					owner = { is_country_type = planet_state }
				}
				owner = {
					save_event_target_as = target_planet_state
				}
			}
		}

		owner = {
			establish_communications_no_message = event_target:target_planet_state
			save_event_target_as = target_default_country
			country_event = { id = story.7 days = 2}
		}
	}

	option = {
		name = SCUM
		trigger = { owner = { has_valid_civic = civic_fanatic_purifiers } }
	}
	option = {
		name = TASTY
		trigger = { owner = { has_valid_civic = civic_hive_devouring_swarm } }
	}
	option = {
		name = EXTERMINATE
		trigger = { owner = { has_valid_civic = civic_machine_terminator } }
	}

	option = {
		name = ps.5.a
		trigger = { owner = { is_homicidal = no } }
	}

	after = {
		event_target:target_default_country = {
			if = {
				limit = {
					is_xenophile = yes
				}
				add_monthly_resource_mult = {
					resource = influence
					value = @tier1influencecontactxenophile
					min = @tier1influencecontactmin
					max = @tier1influencecontactmax
				}
			}
			else = {
				add_monthly_resource_mult = {
					resource = influence
					value = @tier1influencecontact
					min = @tier1influencecontactmin
					max = @tier1influencecontactmax
				}
			}

			hidden_effect = {
				country_event = { id = ps.13 }
			}
		}
	}
}

# ps.13: First contact with Planet-State
country_event = {
	id = ps.13
	title = ps.13.name
	desc = {
		trigger = {
			event_target:target_planet_state = { has_country_flag = ps_egalitarian }
		}
		text = ps.13.desc.egalitarian
	}
	desc = {
		trigger = {
			event_target:target_planet_state = { has_country_flag = ps_authoritarian }
		}
		text = ps.13.desc.authoritarian
	}
	desc = {
		trigger = {
			event_target:target_planet_state = { has_country_flag = ps_militarist }
		}
		text = ps.13.desc.militarist
	}
	desc = {
		trigger = {
			event_target:target_planet_state = { has_country_flag = ps_pacifist }
		}
		text = ps.13.desc.pacifist
	}

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_planet_state
		planet_background = event_target:target_planet_state
		graphical_culture = event_target:target_planet_state
		city_level = event_target:target_planet_state
		room = event_target:target_planet_state.ruler
	}

	option = {
		name = ps.13.a
		trigger = { is_homicidal = no }
	}

	option = {
		name = SCUM
		trigger = { has_valid_civic = civic_fanatic_purifiers }
	}
	option = {
		name = TASTY
		trigger = { has_valid_civic = civic_hive_devouring_swarm }
	}
	option = {
		name = EXTERMINATE
		trigger = { has_valid_civic = civic_machine_terminator }
	}
}

# ps.100: The Ecumenopolis - Main Menu (Initial)
country_event = {
	id = ps.100
	title = ps.100.name
	desc = ps.100a.desc
	location = From

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	trigger = {
		from = {
			is_country_type = planet_state
			has_country_flag = ps_egalitarian
		}
		NOT = { has_country_flag = ps_egalitarian_diplomacy_engaged }
		NOT = { has_country_flag = attacked_ps_egalitarian }
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
		From = { save_event_target_as = target_ps_egalitarian }
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	# Commerce (ps.110)
	option = {
		name = ps.100.a
		trigger = { is_homicidal = no }
		allow = {
			custom_tooltip = {
				fail_text = ps.100.a.alreadyhired
				has_active_ps_egalitarian_trade_deal = no
			}
		}
		hidden_effect = {
			country_event = { id = ps.110 }
		}
	}
	# Cancel trade deal
	option = {
		name = ps.100.ab
		response_text = ps.100.ab.reply
		is_dialog_only = yes
		trigger = { has_active_ps_egalitarian_trade_deal = yes }
		custom_tooltip = ps.100.ab.tooltip
		hidden_effect = { remove_ps_egalitarian_trade_deal = yes }
	}

	# Commercial pact (ps.120)
	option = {
		name = ps.100.b
		trigger = { is_homicidal = no }
		allow = {
			custom_tooltip = {
				fail_text = ps.100.b.opinion
				event_target:target_ps_egalitarian = {
					trust = {
						who = Root
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = ps.100.b.alreadyhired
				NOT = { has_country_flag = hired_ps_army }
			}
		}
		hidden_effect = {
			country_event = { id = ps.120 }
		}
	}

	# Goodbye
	option = {
		name = ps.100.goodbye
		trigger = { is_homicidal = no }
	}

	option = {
		name = SCUM
		trigger = { has_valid_civic = civic_fanatic_purifiers }
	}
	option = {
		name = TASTY
		trigger = { has_valid_civic = civic_hive_devouring_swarm }
	}
	option = {
		name = EXTERMINATE
		trigger = { has_valid_civic = civic_machine_terminator }
	}
}

# ps.101: Egalitarian PS - Main Menu
country_event = {
	id = ps.101
	title = ps.100.name
	desc = ps.100a.desc
	location = From

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	trigger = {
		NOT = { has_country_flag = ps_egalitarian_diplomacy_engaged }
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	# Commerce (ps.110)
	option = {
		name = ps.100.a
		allow = {
			custom_tooltip = {
				fail_text = ps.100.a.alreadyhired
				has_active_ps_egalitarian_trade_deal = no
			}
		}
		hidden_effect = {
			country_event = { id = ps.110 }
		}
	}
	# Cancel trade deal
	option = {
		name = ps.100.ab
		response_text = ps.100.ab.reply
		is_dialog_only = yes
		trigger = { has_active_ps_egalitarian_trade_deal = yes }
		custom_tooltip = ps.100.ab.tooltip
		hidden_effect = { remove_ps_egalitarian_trade_deal = yes }
	}

	# Commercial pact (ps.120)
	option = {
		name = ps.100.b
		allow = {
			custom_tooltip = {
				fail_text = ps.100.b.opinion
				event_target:target_ps_egalitarian = {
					trust = {
						who = Root
						value >= 50
					}
				}
			}
			custom_tooltip = {
				fail_text = ps.100.b.alreadyhired
				NOT = { has_country_flag = hired_ps_army }
			}
		}
		hidden_effect = {
			country_event = { id = ps.120 }
		}
	}

	# Goodbye
	option = {
		name = ps.100.goodbye
	}
}

# ps.110: Resource Deal
country_event = {
	id = ps.110
	title = ps.110.name
	desc = ps.110.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	# 10 CG for 10 Alloys
	option = {
		name = ps.110.a
		allow = {
			resource_stockpile_compare = { resource = energy value >= 1000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_ps_egalitarian }
			}
		}
		add_resource = { energy = -1000 }
		add_modifier = {
			modifier = modifier_ps_egalitarian_trade_deal_1
		}
		hidden_effect = {
			country_event = { id = ps.111 }
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = Root
					amount = 20
				}
			}
		}
	}
	# 20 CG for 20 Alloys
	option = {
		name = ps.110.a
		allow = {
			resource_stockpile_compare = { resource = energy value >= 2000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_ps_egalitarian }
			}
		}
		add_resource = { energy = -2000 }
		add_modifier = {
			modifier = modifier_ps_egalitarian_trade_deal_2
		}
		hidden_effect = {
			country_event = { id = ps.111 }
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = Root
					amount = 20
				}
			}
		}
	}
	# 30 CG for 30 Alloys
	option = {
		name = ps.110.a
		allow = {
			resource_stockpile_compare = { resource = energy value >= 3000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_ps_egalitarian }
			}
		}
		add_resource = { energy = -3000 }
		add_modifier = {
			modifier = modifier_ps_egalitarian_trade_deal_3
		}
		hidden_effect = {
			country_event = { id = ps.111 }
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = Root
					amount = 20
				}
			}
		}
	}
	# 40 CG for 40 Alloys
	option = {
		name = ps.110.a
		allow = {
			resource_stockpile_compare = { resource = energy value >= 4000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_ps_egalitarian }
			}
		}
		add_resource = { energy = -4000 }
		add_modifier = {
			modifier = modifier_ps_egalitarian_trade_deal_4
		}
		hidden_effect = {
			country_event = { id = ps.111 }
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = Root
					amount = 20
				}
			}
		}
	}
	# 50 CG for 50 Alloys
	option = {
		name = ps.110.a
		allow = {
			resource_stockpile_compare = { resource = energy value >= 5000 }
			hidden_trigger = {
				NOT = { has_country_flag = attacked_ps_egalitarian }
			}
		}
		add_resource = { energy = -5000 }
		add_modifier = {
			modifier = modifier_ps_egalitarian_trade_deal_5
		}
		hidden_effect = {
			country_event = { id = ps.111 }
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = Root
					amount = 20
				}
			}
		}
	}

	# Back to the main menu
	option = {
		name = ps.110.back
		hidden_effect = {
			country_event = { id = ps.101 }
		}
	}
	# End
	option = {
		name = ps.100.goodbye
		default_hide_option = yes
	}
}

# ps.111: Resource Deal - Answer
country_event = {
	id = ps.111
	title = ps.110.name
	desc = ps.111.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	# Back to the main menu
	option = {
		name = ps.110.back
		hidden_effect = {
			country_event = { id = ps.101 }
		}
	}
	# End
	option = {
		name = ps.100.goodbye
		default_hide_option = yes
	}
}

# ps.120: Commercial Pact
country_event = {
	id = ps.120
	title = ps.120.name
	desc = ps.120.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	option = {
		name = ps.120.a
		response_text = ps.120.a.reply
		custom_tooltip = opinion50
		add_modifier = {
			modifier = modifier_ps_egalitarian_commercial_pact
		}
		hidden_effect = {
			event_target:target_ps_egalitarian = {
				add_trust = {
					who = root
					amount = 20
				}
			}
		}
	}

	# Back to the main menu
	option = {
		name = ps.110.back
		hidden_effect = {
			country_event = { id = ps.101 }
		}
	}
	# End
	option = {
		name = ps.100.goodbye
		default_hide_option = yes
	}
}

# ps.1000: Egalitarian PS destroyed (HIDDEN) (called by on_country_destroyed)
event = {
	id = ps.1000
	hide_window = yes

	is_triggered_only = yes

	trigger = {
		is_country_type = planet_state
		has_country_flag = ps_egalitarian
	}

	immediate = {
		capital_scope = {
			save_event_target_as = ps_egalitarian_capital
		}
		From = {
			country_event = { id = ps.1001 }
			save_event_target_as = ps_egalitarian_destroyer
		}
		every_country = {
			limit = {
				has_communications = Root
				NOT = { is_country = event_target:ps_egalitarian_destroyer }
				is_country_type = default
			}
			country_event = { id = ps.1002 }
		}
	}
}

# ps.1001: Egalitarian PS destroyed (Destroyer)
country_event = {
	id = ps.1001
	title = ps.1001.name
	desc = ps.1001.desc
	picture = GFX_evt_space_debris
	location = event_target:ps_egalitarian_capital
	show_sound = event_ship_bridge

	is_triggered_only = yes

	immediate = {
		set_country_flag = destroyed_ps_egalitarian
	}

	option = {
		name = EXCELLENT
	}
}

# ps.1002: Egalitarian PS Destroyed
country_event = {
	id = ps.1002
	title = ps.1002.name
	desc = {
		text = ps.1002.a.desc
		trigger = {
			has_any_active_ps_egalitarian_deal = no
			has_communications = event_target:ps_egalitarian_destroyer
		}
	}
	desc = {
		text = ps.1002.b.desc
		trigger = {
			has_any_active_ps_egalitarian_deal = no
			NOT = { has_communications = event_target:ps_egalitarian_destroyer }
		}
	}
	desc = {
		text = ps.1002.c.desc
		trigger = {
			has_any_active_ps_egalitarian_deal = yes
			has_communications = event_target:ps_egalitarian_destroyer
		}
	}
	desc = {
		text = ps.1002.d.desc
		trigger = {
			has_any_active_ps_egalitarian_deal = yes
			NOT = { has_communications = event_target:ps_egalitarian_destroyer }
		}
	}
	picture = GFX_evt_exploding_ship
	location = event_target:ps_egalitarian_capital
	show_sound = event_ship_explosion

	is_triggered_only = yes

	immediate = {
		if = {
			limit = {
				has_any_active_ps_egalitarian_deal = yes
				is_ai = yes
			}
			add_opinion_modifier = {
				who = event_target:ps_egalitarian_destroyer
				modifier = opinion_destroyed_ps_egalitarian_trade
			}
		}
		if = {
			limit = {
				has_any_active_ps_egalitarian_deal = yes
				is_ai = yes
			}
			add_opinion_modifier = {
				who = event_target:ps_egalitarian_destroyer
				modifier = opinion_destroyed_ps_egalitarian
			}
		}
	}

	after = {
		remove_all_ps_egalitarian_deals = yes
	}

	option  = {
		name = ps.1002.a
		trigger = {
			has_any_active_ps_egalitarian_deal = no
		}
	}
	option = {
		name = ps.1002.b
		trigger = {
			has_any_active_ps_egalitarian_deal = yes
		}
	}
}

# ps.1003: Attacked Egalitarian PS (Hidden)
country_event = {
	id = ps.1003
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		is_country_type = default
		From = { has_country_flag = ps_egalitarian }
	}

	immediate = {
		From = {
			save_event_target_as = target_ps_egalitarian
			add_trust = {
				who = Root
				amount = -100
			}
		}
		set_country_flag = attacked_ps_egalitarian
		if = {
			limit = { has_any_active_ps_egalitarian_deal = yes }
			remove_all_ps_egalitarian_deals = yes
			country_event = { id = ps.1004 }
		}
	}
}

# ps.1004: Attacked Egalitarian PS - Agreements Terminated
country_event = {
	id = ps.1004
	title = ps.1004.name
	desc = ps.1004.desc

	is_triggered_only = yes
	diplomatic = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	option = {
		name = ps.1004.a
	}
}

# ps.1005: Attacked Egalitarian PS - Refuses Communications
country_event = {
	id = ps.1005
	title = ps.1005.name
	desc = ps.1005.desc

	is_triggered_only = yes
	diplomatic = yes
	force_open = yes

	picture_event_data = {
		portrait = event_target:target_ps_egalitarian
		planet_background = event_target:target_ps_egalitarian
		graphical_culture = event_target:target_ps_egalitarian
		city_level = event_target:target_ps_egalitarian
		room = event_target:target_ps_egalitarian.ruler
	}

	trigger = {
		From = {
			is_country_type = planet_state
			has_country_flag = ps_egalitarian
		}
		has_country_flag = attacked_ps_egalitarian
		NOT = { has_country_flag = ps_egalitarian_diplomacy_engaged }
	}

	immediate = {
		set_country_flag = ps_egalitarian_diplomacy_engaged
		From = { save_event_target_as = target_ps_egalitarian }
	}

	after = {
		hidden_effect = {
			remove_country_flag = ps_egalitarian_diplomacy_engaged
		}
	}

	option = {
		name = SCUM
		trigger = { has_valid_civic = civic_fanatic_purifiers }
	}
	option = {
		name = TASTY
		trigger = { has_valid_civic = civic_hive_devouring_swarm }
	}
	option = {
		name = EXTERMINATE
		trigger = { has_valid_civic = civic_machine_terminator }
	}
	option = {
		name = ps.1005.a
		trigger = { is_homicidal = no }
		default_hide_option = yes
	}
}
